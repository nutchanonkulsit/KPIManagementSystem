<div
  class="bg-white rounded-2xl p-6 shadow-lg border border-gray-100 hover:shadow-xl transition-all duration-300 relative h-full flex flex-col"
>
  <!-- Status Badge -->
  <div class="absolute top-4 right-4">
    <span
      class="px-3 py-1 text-xs font-semibold rounded-full"
      [ngClass]="{
        'bg-green-100 text-green-800': statusColor === 'green',
        'bg-yellow-100 text-yellow-800': statusColor === 'yellow',
        'bg-red-100 text-red-800': statusColor === 'red'
      }"
    >
      {{ kpi.status }}
    </span>
  </div>

  <div class="flex-grow">
    <!-- KPI Icon -->
    <div
      class="w-12 h-12 bg-gradient-to-br from-green-100 to-green-200 rounded-xl flex items-center justify-center mb-4"
    >
      <svg
        class="w-6 h-6 text-green-600"
        fill="none"
        stroke="currentColor"
        viewBox="0 0 24 24"
      >
        <path
          stroke-linecap="round"
          stroke-linejoin="round"
          stroke-width="2"
          [attr.d]="getIconPath()"
        ></path>
      </svg>
    </div>

    <!-- KPI Details -->
    <h3 class="text-lg font-bold text-gray-900 mb-2 truncate">
      {{ kpi.title }}
    </h3>
    <p class="text-gray-500 text-sm mb-4 line-clamp-2 h-[40px]">
      {{ kpi.description || "No Description" }}
    </p>

    <!-- Progress -->
    <div class="mb-2">
      <div class="flex justify-between items-center mb-2">
        <span class="text-sm text-gray-600">Progress</span>
        <span class="text-sm font-semibold text-gray-900"
          >{{ kpi.actual_value }} / {{ kpi.target_value }}</span
        >
      </div>
      <div class="w-full bg-gray-200 rounded-full h-2">
        <div
          class="h-2 rounded-full max-w-full"
          [ngClass]="{
            'bg-green-400': statusColor === 'green',
            'bg-yellow-400': statusColor === 'yellow',
            'bg-red-400': statusColor === 'red'
          }"
          [style.width.%]="progressPercent"
        ></div>
      </div>
      <div class="text-sm font-semibold text-gray-900 text-end">
        {{ progressPercent }}%
      </div>
    </div>

    <!-- Meta Info -->
    <div class="flex items-center justify-end text-sm text-gray-500 mb-1">
      <span>Due: {{ kpi.end_date | date : "mediumDate" }}</span>
    </div>
    <div class="flex items-center justify-end text-sm text-gray-500 mb-2">
      <span>Assign To: {{ kpi.assigned_username }}</span>
    </div>
  </div>

  <!-- Action Buttons pinned bottom -->
  <div class="flex space-x-2 mt-auto">
    <button
      (click)="openViewDialog(kpi)"
      class="flex-1 px-4 py-2 bg-blue-50 text-blue-600 rounded-lg hover:bg-blue-100 transition-colors text-sm font-medium"
    >
      View
    </button>
    <button
      (click)="openUpdateDialog(kpi)"
      class="flex-1 px-4 py-2 bg-orange-50 text-orange-600 rounded-lg hover:bg-blue-100 transition-colors text-sm font-medium"
    >
      Update
    </button>
    <button
      (click)="openEditDialog(kpi)"
      class="flex-1 px-4 py-2 bg-gray-50 text-gray-600 rounded-lg hover:bg-gray-100 transition-colors text-sm font-medium"
    >
      Edit
    </button>
    <button
      (click)="deleteKPI()"
      class=" px-4 py-2 bg-red-50 text-red-600 rounded-lg hover:bg-red-100 transition-colors text-sm font-medium"
    >
      <svg
        class="w-4 h-4"
        fill="none"
        stroke="currentColor"
        viewBox="0 0 24 24"
      >
        <path
          stroke-linecap="round"
          stroke-linejoin="round"
          stroke-width="2"
          d="M19 7l-.867 12.142A2 2 0 0116.138 21H7.862a2 2 0 01-1.995-1.858L5 7m5 4v6m4-6v6m1-10V4a1 1 0 00-1-1h-4a1 1 0 00-1 1v3M4 7h16"
        ></path>
      </svg>
    </button>
  </div>
</div>
